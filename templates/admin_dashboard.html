<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - DriveGo</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='CSS/admin_dashboard.css') }}">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="admin-container">
        <!-- Header simplifi√© -->
        <header class="header">
            <div class="header-content">
                <div class="logo-section">
                    <a href="{{ url_for('index') }}" class="logo">
                        <img src="../static/images/logo perce-neige.PNG" alt="Logo Fondation Perce-Neige" class="logo-image">
                    </a>
                    <div class="header-text">
                        <h1>Administration DriveGo</h1>
                        <p>Gestion du parc automobile et des utilisateurs</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-outline" onclick="showModal('inviteUserModal')">
                        <span class="icon">‚úâÔ∏è</span>
                        Inviter un conducteur
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation principale -->
        <nav class="main-nav">
            <button class="nav-tab active" onclick="showSection('dashboard')" data-section="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Tableau de bord</span>
            </button>
            <button class="nav-tab" onclick="showSection('vehicles')" data-section="vehicles">
                <span class="nav-icon">üöó</span>
                <span class="nav-text">Parc automobile</span>
            </button>
            <button class="nav-tab" onclick="showSection('users')" data-section="users">
                <span class="nav-icon">üë•</span>
                <span class="nav-text">Conducteurs</span>
            </button>
            <button class="nav-tab" onclick="showSection('maintenance')" data-section="maintenance">
                <span class="nav-icon">üîß</span>
                <span class="nav-text">Maintenance</span>
            </button>
        </nav>

        <!-- Dashboard -->
        <section id="dashboard" class="content-section active">
            <div class="section-header">
                <h2 class="section-title">Vue d'ensemble</h2>
                <div class="section-actions">
                    <button class="btn btn-export" onclick="exportDashboardCSV()">
                        <span class="icon">üìä</span>
                        Exporter CSV
                    </button>
                    <button class="btn btn-export" onclick="exportDashboardPDF()">
                        <span class="icon">üìÑ</span>
                        Exporter PDF
                    </button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">üöó</div>
                    <div class="stat-content">
                        <h3 id="totalVehicles">5</h3>
                        <p>V√©hicules actifs</p>
                        <small class="stat-detail">Tous statuts confondus</small>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚úÖ</div>
                    <div class="stat-content">
                        <h3 id="availableVehicles">3</h3>
                        <p>V√©hicules disponibles</p>
                        <small class="stat-detail">Pr√™ts √† l'utilisation</small>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">üë•</div>
                    <div class="stat-content">
                        <h3 id="totalUsers">12</h3>
                        <p>Conducteurs actifs</p>
                        <small class="stat-detail">Comptes valid√©s</small>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">‚ö†Ô∏è</div>
                    <div class="stat-content">
                        <h3 id="alertsCount">2</h3>
                        <p>Alertes actives</p>
                        <small class="stat-detail">Contr√¥les techniques</small>
                    </div>
                </div>
            </div>

            <!-- Alertes et notifications -->
            <div class="alerts-section">
                <h3>Alertes importantes</h3>
                <div class="alert-list">
                    <div class="alert-item warning">
                        <div class="alert-icon">‚ö†Ô∏è</div>
                        <div class="alert-content">
                            <strong>Contr√¥le technique √† renouveler</strong>
                            <p>TRAFIC VERT (EJ-374-TT) - √âch√©ance : 12/03/2025</p>
                        </div>
                        <div class="alert-actions">
                            <button class="btn btn-sm">Voir d√©tails</button>
                        </div>
                    </div>
                    <div class="alert-item warning">
                        <div class="alert-icon">‚ö†Ô∏è</div>
                        <div class="alert-content">
                            <strong>Contr√¥le technique √† renouveler</strong>
                            <p>TRAFIC ROUGE (CW-819-FR) - √âch√©ance : 27/01/2025</p>
                        </div>
                        <div class="alert-actions">
                            <button class="btn btn-sm">Voir d√©tails</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gestion des v√©hicules -->
        <section id="vehicles" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Parc automobile</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="showModal('addVehicleModal')">
                        <span class="icon">‚ûï</span>
                        Ajouter un v√©hicule
                    </button>
                    <button class="btn btn-export" onclick="exportVehiclesCSV()">
                        <span class="icon">üìä</span>
                        Exporter
                    </button>
                </div>
            </div>

            <div class="filters-section">
                <div class="search-bar">
                    <input type="text" id="vehicleSearch" placeholder="Rechercher par nom, immatriculation...">
                    <button class="search-btn">üîç</button>
                </div>
                <div class="filter-controls">
                    <select id="statusFilter">
                        <option value="">Tous les statuts</option>
                        <option value="actif">Actif</option>
                        <option value="maintenance">En maintenance</option>
                        <option value="hors-service">Hors service</option>
                    </select>
                </div>
            </div>

            <div class="vehicles-grid" id="vehiclesGrid">
                <!-- Les v√©hicules seront charg√©s dynamiquement -->
            </div>
        </section>

        <!-- Gestion des utilisateurs -->
        <section id="users" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Conducteurs</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="showModal('addUserModal')">
                        <span class="icon">‚ûï</span>
                        Ajouter un conducteur
                    </button>
                    <button class="btn btn-export" onclick="exportUsersCSV()">
                        <span class="icon">üìä</span>
                        Exporter
                    </button>
                </div>
            </div>

            <div class="filters-section">
                <div class="search-bar">
                    <input type="text" id="userSearch" placeholder="Rechercher par nom, email...">
                    <button class="search-btn">üîç</button>
                </div>
                <div class="filter-controls">
                    <select id="userStatusFilter">
                        <option value="">Tous les statuts</option>
                        <option value="actif">Actif</option>
                        <option value="suspendu">Suspendu</option>
                        <option value="en-attente">En attente</option>
                    </select>
                </div>
            </div>

            <div class="users-table-container">
                <table class="modern-table">
                    <thead>
                        <tr>
                            <th>Conducteur</th>
                            <th>Contact</th>
                            <th>Statut</th>
                            <th>Derni√®re activit√©</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Les utilisateurs seront charg√©s dynamiquement -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Section maintenance -->
        <section id="maintenance" class="content-section">
            <div class="section-header">
                <h2 class="section-title">Maintenance et contr√¥les</h2>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="showModal('addMaintenanceModal')">
                        <span class="icon">üîß</span>
                        Programmer une maintenance
                    </button>
                </div>
            </div>

            <div class="maintenance-overview">
                <div class="maintenance-stats">
                    <div class="maintenance-stat">
                        <h4>2</h4>
                        <p>Contr√¥les techniques √† renouveler</p>
                    </div>
                    <div class="maintenance-stat">
                        <h4>1</h4>
                        <p>V√©hicule en maintenance</p>
                    </div>
                    <div class="maintenance-stat">
                        <h4>0</h4>
                        <p>Assurances √† renouveler</p>
                    </div>
                </div>
            </div>

            <div class="maintenance-calendar">
                <h3>Prochaines √©ch√©ances</h3>
                <div class="calendar-items">
                    <div class="calendar-item urgent">
                        <div class="calendar-date">
                            <span class="day">27</span>
                            <span class="month">Jan</span>
                        </div>
                        <div class="calendar-content">
                            <strong>Contr√¥le technique - TRAFIC ROUGE</strong>
                            <p>CW-819-FR ‚Ä¢ Urgent</p>
                        </div>
                        <div class="calendar-actions">
                            <button class="btn btn-sm btn-primary">Planifier</button>
                        </div>
                    </div>
                    <div class="calendar-item warning">
                        <div class="calendar-date">
                            <span class="day">12</span>
                            <span class="month">Mar</span>
                        </div>
                        <div class="calendar-content">
                            <strong>Contr√¥le technique - TRAFIC VERT</strong>
                            <p>EJ-374-TT ‚Ä¢ √Ä pr√©voir</p>
                        </div>
                        <div class="calendar-actions">
                            <button class="btn btn-sm btn-primary">Planifier</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Modal d'invitation -->
    <div id="inviteUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Inviter un nouveau conducteur</h2>
                <button class="modal-close" onclick="closeModal('inviteUserModal')">√ó</button>
            </div>
            <form id="invitationForm" onsubmit="sendInvitation(event)">
                <div class="form-group">
                    <label for="inviteEmail">Adresse email</label>
                    <input type="email" id="inviteEmail" placeholder="conducteur@fondation-perceneige.org" required>
                </div>
                <div class="form-group">
                    <label for="inviteMessage">Message personnalis√© (optionnel)</label>
                    <textarea id="inviteMessage" rows="3" placeholder="Message d'accueil pour le nouveau conducteur..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('inviteUserModal')">Annuler</button>
                    <button type="submit" class="btn btn-primary">Envoyer l'invitation</button>
                </div>
            </form>
            <div id="inviteResult" class="form-result"></div>
        </div>
    </div>

    <!-- Modal v√©hicule -->
    <div id="addVehicleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ajouter un v√©hicule</h2>
                <button class="modal-close" onclick="closeModal('addVehicleModal')">√ó</button>
            </div>
            <form id="vehicleForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="vehicleName">Nom du v√©hicule</label>
                        <input type="text" id="vehicleName" placeholder="ex: TRAFIC BLANC" required>
                    </div>
                    <div class="form-group">
                        <label for="vehiclePlate">Immatriculation</label>
                        <input type="text" id="vehiclePlate" placeholder="AB-123-CD" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="vehicleBrand">Marque</label>
                        <select id="vehicleBrand" required>
                            <option value="">S√©lectionner...</option>
                            <option value="Renault">Renault</option>
                            <option value="Peugeot">Peugeot</option>
                            <option value="Citro√´n">Citro√´n</option>
                            <option value="Ford">Ford</option>
                            <option value="Mercedes">Mercedes</option>
                            <option value="Volkswagen">Volkswagen</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="vehicleModel">Mod√®le</label>
                        <input type="text" id="vehicleModel" placeholder="ex: Trafic, Kangoo" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="vehicleRegistrationDate">Date d'immatriculation</label>
                    <input type="date" id="vehicleRegistrationDate" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addVehicleModal')">Annuler</button>
                    <button type="submit" class="btn btn-primary">Ajouter le v√©hicule</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal utilisateur -->
    <div id="addUserModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Ajouter un conducteur</h2>
                <button class="modal-close" onclick="closeModal('addUserModal')">√ó</button>
            </div>
            <form id="userForm">
                <div class="form-row">
                    <div class="form-group">
                        <label for="userFirstName">Pr√©nom</label>
                        <input type="text" id="userFirstName" placeholder="Jean" required>
                    </div>
                    <div class="form-group">
                        <label for="userLastName">Nom</label>
                        <input type="text" id="userLastName" placeholder="Dupont" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="userEmail">Email</label>
                    <input type="email" id="userEmail" placeholder="jean.dupont@fondation-perceneige.org" required>
                </div>
                <div class="form-group">
                    <label for="userPhone">T√©l√©phone</label>
                    <input type="tel" id="userPhone" placeholder="06 12 34 56 78">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addUserModal')">Annuler</button>
                    <button type="submit" class="btn btn-primary">Ajouter le conducteur</button>
                </div>
            </form>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/admin_dashboard.js') }}"></script>
    
</body>
</html>